#!/bin/sh
# cursor-prompt - Send prompts to Cursor IDE
#
# Usage:
#   cursor-prompt --start [--workspace PATH]   # Launch Cursor (log in once)
#   cursor-prompt "prompt"                     # Send prompt
#   cursor-prompt --status                     # Check status
#   cursor-prompt --stop                       # Stop Cursor
#
# This script is designed to be called by test-agents.sh

set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

# Ensure dependencies are installed
ensure_deps() {
    if [ ! -d "$SCRIPT_DIR/node_modules" ]; then
        echo "Installing dependencies..." >&2
        (cd "$SCRIPT_DIR" && npm install --silent) >&2
    fi

    if [ ! -d "$SCRIPT_DIR/extension/node_modules" ]; then
        echo "Installing extension dependencies..." >&2
        (cd "$SCRIPT_DIR/extension" && npm install --silent) >&2
    fi

    if [ ! -d "$SCRIPT_DIR/extension/out" ]; then
        echo "Compiling extension..." >&2
        (cd "$SCRIPT_DIR/extension" && npm run compile) >&2
    fi
}

# Ensure dependencies
ensure_deps

# Pass all arguments to Node script
exec node "$SCRIPT_DIR/run-prompt.js" "$@"
